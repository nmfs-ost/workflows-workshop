---
title: "Day 3"
format: html
---

::: objectives
-   Work through a guided demo of a more complex `asar` workflow
-   Learn about the value of the `stockplotr` R package
-   Understand how to integrate `stockplotr` into an `asar`-based reporting workflow
-   Work through a guided demo of a basic `stockplotr` workflow
:::

# Introduction
## Icebreaker

Welcome! Please open the [Day 3 communal notes doc](https://docs.google.com/document/d/1SY-xwHXnJUXSXTTeaPA_UkmXXVmUK9Ol751nh6Vtjmg/edit?tab=t.vffehz79fm7y#heading=h.sfq3xaeehv64) and participate in the icebreaker exercise.

::: {.callout-tip}
**Reminder**: For comments or questions, please raise your hand, or write them in the chat, *at any time*. Depending on our schedule, we may ask that you save larger questions for breaks.
::: 

# Introduction to `stockplotr`

## Installation

::: {.callout-tip}
### Tip

The following packages are already installed in the `asar` workspace on JupyterHub, so if you are using that space, you can skip this section.
:::

```r
install.packages("pak")
pak::pak("nmfs-ost/asar")
pak::pak("nmfs-ost/stockplotr")
```

Please see the [`stockplotr` README](https://github.com/nmfs-ost/stockplotr) for more installation options.

## `stockplotr` workflow: Basic example

### Convert output (if necessary)

First, you'll need to convert your model results using the same workflow covered yesterday: `asar::convert_output()`.

You can use the example Report.sso file uploaded to the workshop GitHub or, if you have a compatible output file, your own.

```{r}
#| label: conout-ex
#| eval: false
#| warning: false
#| messages: false
# Identify output file
output_file <- here::here("example_output", "Report.sso")
# convert the output and save it as an rda
petrale <- asar::convert_output(output_file,
                                save_dir = getwd())
```

If you have already converted your output: great! Import it into your R environment so that you can handle it as an object like "petrale" in the chunk above.

### Create single plots

- Export single plots
- Create and export all plots
- How to customize (changing color palette, etc.)

# Integrating stockplotr in the workflow

After running `create_template()`, you'll see figures and tables files, named something like '08_tables.qmd' and '09_figures.qmd' (the prefix numbers may vary).

Each file will contain zero figures or tables. Instead, they will contain a statement referring you to {stockplotr} so that you can make your own. Since we've created those already, let's add them to your report!

You can add your figures and tables with two workflows:

1. Rerunning `asar::create_tables_doc()` and `asar::create_figures_doc()`
  - If you fill in arguments that allow R to find your tables and figures, then it will place them into the respective tables and figures docs automatically.
2. Adding your tables and figures manually to each doc.

## Option 1: Rerunning `asar::create_tables_doc()`/`asar::create_figures_doc()`

### Tables

To add tables, first ensure that your folder containing the tables is called "tables".

Then, there are only two arguments to fill out:

1. `subdir`: The location where the *new* tables doc should be saved (we recommend your 'report' folder, so it overwrites the old, empty version)
2. `tables_dir`: The location of your "tables" folder

```{r}
#| label: add-tables
#| eval: false
#| warning: false
#| messages: false
create_tables_doc(
  subdir = fs::path(getwd(), "report"), # indicates the new tables doc will be saved in your "report" folder, located in the working directory
  tables_dir = getwd() # indicates your "tables" folder is located in the working directory
                  )
```

Now, open your new tables doc and take a look!

You'll notice the following structure:

**Chunk 1** will always create an object saving the location of your `tables_dir`.

Then, there will be at least two chunks for each table. For tables that are *regularly-sized* (i.e., small enough that they don't need to be rotated or split across pages):

**Chunk 2** will:

* load an rda containing a table
* give the rda a specific name
* save the table and caption as separate objects

**Chunk 3** will:

* display the table

::: {.callout-note}
This workflow can also accommodate tables that are wide enough to require rotation into a landscape-view page OR splitting across pages. For more information, please see the ["Adding Custom Tables & Figures" vignette](https://nmfs-ost.github.io/asar/articles/custom-figs-tabs.html#sec-id_width).
:::

### Figures

Adding figures entails nearly the same process as described for tables. The only differences are:

1. Figures will involve captions and *alternative text*, whereas tables only require captions
2. Figures do not require the option to be rotated or split across pages.

## Option 2: Manually adding tables/figures

You can add a regularly-sized^[Again, for tables that require rotating or splitting across pages, please refer to the ["Adding Custom Tables & Figures" vignette](https://nmfs-ost.github.io/asar/articles/custom-figs-tabs.html#sec-id_width).] table/figure manually by following these main steps:

1. Create a code chunk
2. Add your label and other chunk options
3. Add code
4. Write caption
5. Add a page break between tables (optional but recommended)

### Tables

Example from the ["Adding Custom Tables & Figures" vignette](https://nmfs-ost.github.io/asar/articles/custom-figs-tabs.html#direct-coding-in-qmd-workflow-option-3-2):

````{verbatim}
```{r} 
#| label: 'tbl-custom1' # choose a label
#| tbl-cap: !expr This is your table caption.

# Import your data
petrale <- load(fs::path("std_output.rda"))

# Make your table
your_table <- head(petrale) |>
  dplyr::select(label, year, estimate) |>
  flextable::flextable()

# Show your table
your_table
``` 
````

![](images/petrale_table.png)

Then, add a pagebreak:

```{r} 
#| label: 'pgbreak'
#| eval: false
#| echo: true

{{< pagebreak >}}

``` 

::: {.callout-tip}
It will be important to add your captions and labels into a csv file when making your documents accessible. You will learn more about this in a few moments!
:::


#### Non-coded tables (e.g., images)

We don't recommended adding non-coded tables (e.g., images), since it significantly reduces the accessibility of your table. However, we understand that sometimes this is the only format available.

Use the following notation to reference an external table as an image:

`![Caption for my example table](example_table.png){fig-alt="This is the alternative text for my table", #tbl-example}`

::: {.callout-note}
Notice how there is alternative text added to this method of adding a table. In this scenario, the table is recognized as an image and thus would NOT pass accessibility checks. **Please make sure you add alternative text for image-based tables added in this way.**
:::

### Figures

Like with our tables file, a blank figures quarto file is created. We add figures similarly to tables.

Steps for adding a figure:

1. Create a code chunk
2. Add your label and other options
3. Add code
4. Write caption and **alternative text**

[**Highlight the difference with a figure needing alternative text**]

**Add a code chunk for each table**

```{r}
#| label: fig-example
#| eval: false
#| echo: true
#| warning: false
#| fig-cap: This is my caption for the example table.
#| fig-alt: This is my alternative text for an HTML doc.
plot(cars$speed, cars$dist)
```


### Non-coded figures

Like tables, you can reference figures not made directly in code chunks. However, in this case, this does *not* change the accessibility of the figure because you can still add the necessary components to meet Section 508 compliance standards: alternative text and a caption.

`![Caption for my example figure](example_figure.png){fig-alt="This is the alternative text for my figure", #fig-example}`

## Referencing your tables or figures in text

Quarto uses a special notation to allow users to link tables and figures throughout their text. Use the following notation to link/reference tables in your text:

`\@tbl-example` or `\@fig-example`

Adding an `@` symbol followed by the chunk label, or label of your table/figure, will create an interactive link that lets the reader navigate to that specific table/figure.

[Show working example within positron]

**Put it all together!**

Render your entire document and take a look at what we've made today.

# Adding accessibility features



# Demo for a realistic, customized asar report with stockplotr plots

- create_tables_doc() and create_figures_doc() with "figures" and "tables" folders
- ensure alt text/captions work

**Time to practice, ask questions, etc.**

# Questions, comments, and feedback

Please navigate to the [Feedback](https://docs.google.com/document/d/1SY-xwHXnJUXSXTTeaPA_UkmXXVmUK9Ol751nh6Vtjmg/edit?tab=t.vffehz79fm7y#heading=h.llbcc8tygqlb) heading and tell us what you thought about today's workshop. Only 3 simple questions!

* What went well?
* What could be improved?
* What is a question you still have?